Bootstrap: localimage
From: base.sif

%post
  apt install -y --no-install-recommends libblas-dev liblapack-dev

  git clone -b main https://github.com/yahoojapan/ngt.git

  cd ngt

  git config --global --add safe.directory /ngt
  git reset --hard 4cf73864cfc5a5e005d1eead63a57e56d6dcba4c

  mkdir build
  cd build
  cmake -DNGTQG_NO_ROTATION=ON -DNGTQG_ZERO_GLOBAL=ON ..
  make -j && make install
  cd ..

  ldconfig

  cd python
  python3 setup.py bdist_wheel
  pip install --no-cache-dir dist/ngt-*-linux_x86_64.whl
